# Changelog

## [v1.1.1] - 2025.05.12

### Added
- Новые типы свойств: `TYPE_MODEL` и `TYPE_ARRAY_MODEL`
- Модуль `sg-json.js` с расширенными возможностями сериализации
- Метод `SGJson.debug(value)` для отладки сложных структур данных
- Флаги для контроля вывода JSON (например, `WITH_EMPTIES`, `PRINT_OBJECT_TYPE`)
- Функция `getDebugInfo()` для улучшенного вывода ошибок

### Changed
- Крупный рефакторинг архитектуры (выделены модули sg-utils, sg-types, sg-json)
- Улучшена работа `validateProperty()` с коллекциями (Set, Map)
- Переработана система инициализации и deferred-свойств
- Оптимизирована работа `destroy()` с вложенными инстансами
- Улучшена система флагов (`FLAGS.*`)

### Fixed
- Исправлены проблемы с инициализацией при resolve() промиса
- Исправлена работа с HTML-элементами в SGModelView
- Исправления в работе с типами `TYPES.XY`

### Deprecated
- Удалены статические методы get(), set() в пользу getInstance()
- Удален метод getAllData() (заменен флагами `ALL_ATTRIBUTES` + `WITH_EMPTIES`)

### Tests
- Добавлены новые автотесты
- Улучшена система сравнения JSON в тестах
- Вынесены эталонные JSON в отдельные файлы
- Добавлен синхронный автоскроллинг в сравнениях JSON

### Docs
- Обновлен README
- Добавлены комментарии к коду

## [v1.1.0] - 2025.04.04

Изменения:
* Исправление багов в v1.0.9 (в частности по `SGModel.initObjectByObject()`, `this.validateProperty()`, `this.removeFrom()`, `SGModel.clone()`, `this.trigger()` теперь обновляет UI, по атрибуту **sg-css**);
* Атрибут **sg-class** переименован в **sg-model**, +сделана возможность использовать как существующий HTML-контент внутри контейнера с атрибутом **sg-model**, так и динамическую загрузку контента из файла (задан **static autoLoadBind.srcHTML**);
* **this.initialized** присваивается в `true` когда выполнены оба промиса (результат `this.initialize()` и `this.initialization.promise`).
* В **this.bindHTML()** добавлен второй необязательный параметр - mTemplate. Т.о. можно, задав mTemplate, предварительно вывести содержимое шаблона.
* В атрибуте **sg-value** помимо текущих возможностей вызывать методы в this с простыми параметрами в виде чисел и строк (например: `sg-value="getSomeMethod(50, 'text…')"`), а также выводить статические свойства собственного класса (например: `sg-value="Salary.LABOR_DISCONT_PER"`), теперь поддерживает вывод свойств из this.data и любых статических свойств любого класса-потомка от SGModel и SGModelView, например: `sg-value="OtherCustomView.PROP5"`.
* По коллекциям и **sg-for**:
  * Возможность тело шаблона элемента коллекции размещать сразу в корневом элементе коллекции, т.е. вместо, например, `<div sg-for="kinds" sg-template="tmp_record_kind" sg-click="onClickRecordKinds"></div>…<template id="tmp_record_kind">[…HTML-код элемента коллекции…]</template>` будет:
`<div sg-for="kinds" sg-template="tmp_record_kind" sg-click="onClickRecordKinds">[…HTML-код элемента коллекции…]</div>`, причём шаблон получит название из атрибута **sg-template**, т.е. tmp_record_kind. Внимание! Шаблон будет переопределён, если будет найден шаблон-TEMPLATE с этим же `id="tmp_record_kind"`!
  * Возможность трансформировать элементы коллекции с помощью параметра-функции **options.format** в `this.set(…);` и `this.addTo(…)`;
  * Универсальная функция **this.forEach()** для перебора элементов коллекции: `this.forEach(propName, (item, indexOrKey) => { … });` где коллекция м.б. Array, Object, Set или Map;
  * Добавлен атрибут **sg-item-variables** с переменными в циклах, например, для подстановки css-класса и атрибута type ("checkbox", "radio") для тега INPUT в каждой записи цикла: `sg-item-variables="{ $tagClass: 'text-bg-primary', $inputType: input_type }"`, пример html-кода: `<template id="tmp_tag"><li class="$tagClass"><input type="$inputType" sg-property="checked"/><span>$title</span></li></template>`. Если значение  переменной без кавычек (в примере это input_type), то движок будет подставлять сюда значение свойства (если оно существует). На данный момент перерисовка UI выполняется только при вызове одного из методов: `set()`, `addTo()`, `removeFrom()` и `trigger()`, т.е. после изменения субсвойства у элемента коллекции на прямую, например, `this.data.tags[2].checked = true;` нужно дополнительно вызвать один из методов, например: `this.trigger('tags')`;
  * Изменён формат значения в автоматически генерируемых атрибутах **sg-item**, примеры: `"id:12345:ef285acc9eacae48"`, `"hash:c67af2274ff09ca1"`. Здесь же поддержка BigInt для значений ключа с именем id (например, для ключей bigserial в PostgreSQL);
  * В элементах коллекции реализована поддержка `INPUT[type=checkbox]` и `INPUT[type=radio]`, sg-атрибутов **sg-format**, **sg-css** и **sg-value**, системных субсвойств **$index** (для массивов) и **$key** (для объектов). Т.о. можно сделать динамический **sg-dropdown** список, элементы в который могут подгружаться позже (обновить UI списка можно через `this.trigger('mylist');`).
  * Метод `this.destroy(noRemoveDOM = false)` в SGModelView теперь удаляет (по умолчанию) элементы в DOM вьюхи, либо очищает их от аспектов SGModelView.
* Парсер **this.parsePgArrayString()** теперь поддерживает специальные символы (функция используется для парсинга массивов из БД PostgreSQL из текстового представления);
* Страница автотестов. Базовые тесты по SGModel и SGModelView.
* Начиная с v1.1.0+ копии релизов вместе с README.md остаются в директориях `/src/vX.Y.Z/*.*`, а автотесты не дублируются. +ESLint, +CHANGELOG.md

## [v1.0.9] - 2025.02.22

* Добавлен метод `this.validateProperty()`;
* Реализована поддержка сложных типов: Array, Object, Set, Map
* Изменены/добавлены новые методы:
	* `this.clearProperty()` - установить "нулевое" значение свойству;
	* `this.clearToDefaults()` вместо `this.clear()`. Установить значения по умолчанию;
	* `this.clear()` использует `this.clearProperty()`;
* Атрибут **sg-item** в записях списка **sg-for**. Генерация SHA-256 хешей для верификации записей. Добавлен стандартный метод `this.getForItem()` для получения выбранной записи коллекции;
* Тег **SECTION** при вставке контента шаблона добавляется только когда в шаблоне несколько элементов на первом уровне;
* Снова добавлен атрибут **sg-class**, но теперь в нём можно прописать имя класса для альтернативной автоматической инициализации экземпляра (автоинициализация);
* Возможность задавать префикс атрибутов в тегах. По умолчанию все атрибуты в представлении начинаются с `"sg-"`. Задаётся глобально, например: `SGModelView.setAttributesPrefix('sg-');`.

## [v1.0.8] - 2025.02.09

* Начальная поддержка **sg-for** и **sg-template**;
* Переименован и сделан приватным `this.properties` на `this.#data` с доступом к свойствам на чтение/изменение через Proxy-объект `this.data` (помимо существующих методов get(), set(), addTo() и т.д.);
* **sg-class** убран, теперь всё в **sg-uuid** с разделителем "/".

## [v1.0.7] - 2025.02.02 (requires ES2024+)

* Последовательность вывода контента сделана в том же порядке, в каком вызывались конструкторы при создании экземпляров;
* Добавлено статическое свойство для вывода информационных атрибутов **sg-uuid** и **sg-class**: `static enablePrintingUUIDClass = true;`;
* Добавлена поддержка INPUT с type=time;
* Добавлены методы `this.addTo()`, `this.removeFrom()` и `this.clear()` для работы с коллекциями (массивы, объекты, Set, Map). Новые типы `SGModel.TYPE_SET` и `SGModel.TYPE_MAP`.

## [v1.0.6] - 2025.01.22

* Для автоматической загрузки и биндинга добавлен статический объект: `static autoLoadBind = { srcHTML, templateId, viewId }`;
* В SGModel добавлены статические объекты **__instances** и **__instancesByClass** для хранения ссылок на все созданные экземпляры на основе SGModel;
* В корневом DOM-элементе представления добавляется свойство **__SGModelUUID** со значением UUID экземпляра, например, "fd89fa7f-b718-44ec-bdd5-abcfb9da50b1".

## [v1.0.0]...[v1.0.5] - 2020.10.22...2025.01.16

* Реализован основной функционал, достаточный для реализации простой динамической веб-страницы, в т.ч.:
	* **SGModel**: поддержка основных типов данных и возможность задать колбэки при изменении данных;
	* **SGModelView**: полная/частичная поддержка функциональности атрибутов **sg-property**, **sg-value**, **sg-type**, **sg-format**, **sg-attributes**, **sg-css**, **sg-click**, **sg-options**.